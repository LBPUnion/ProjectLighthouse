@using LBPUnion.ProjectLighthouse.Database
@using LBPUnion.ProjectLighthouse.Localization
@using LBPUnion.ProjectLighthouse.Servers.Website.Extensions
@using LBPUnion.ProjectLighthouse.Types.Entities.Level
@using LBPUnion.ProjectLighthouse.Types.Entities.Profile
@using Microsoft.EntityFrameworkCore
@model (List<(int Rank, ScoreEntity Score)> Scores, int scoreType) 
@inject DatabaseContext Database
@{
    string language = (string?)ViewData["Language"] ?? LocalizationManager.DefaultLang;
    string timeZone = (string?)ViewData["TimeZone"] ?? TimeZoneInfo.Local.Id;
    bool canDelete = (bool?)ViewData["CanDelete"] ?? false;
}          

<div class="ui list">
    @for (int i = 0; i < Model.Scores.Count; i++)
    {
        (int Rank, ScoreEntity Score) scoreAndRank = Model.Scores[i];
        string[] playerIds = scoreAndRank.Score.PlayerIds;
        <div class="item">
            <span class="ui large text">
                @if (canDelete)
                {
                    <button class="ui red icon button" style="display: inline-block; position: absolute; right: 1em" onclick="deleteScore(@scoreAndRank.Score.ScoreId)">
                        <i class="trash icon"></i>
                    </button>
                }
                <b>@(scoreAndRank.Rank):</b>
                <span class="ui text">@scoreAndRank.Score.Points points</span>
            </span>
            <div class="content">
                <div class="list" style="padding-top: 0">
                    @for (int j = 0; j < playerIds.Length; j++)
                    {
                        UserEntity? user = await Database.Users.FirstOrDefaultAsync(u => u.Username == playerIds[j]);
                        <div class="item">
                            <i class="minus icon" style="padding-top: 9px"></i>
                            <div class="content" style="padding-left: 0">
                                @if (user != null)
                                {
                                    @await user.ToLink(Html, ViewData, language, timeZone)
                                }
                                else
                                {
                                    <p style="margin-top: 5px;">@playerIds[j]</p>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
        @if (i != Model.Scores.Count - 1)
        {
            <div class="ui divider"></div>
        }
    }
</div>
<script>
        function deleteScore(scoreId){
            if (window.confirm("Are you sure you want to delete this?\nThis action cannot be undone.")){
                window.location.hash = "scores";
                window.location.href = "/moderation/deleteScore/" + scoreId + "?callbackUrl=" + this.window.location;
            }
        }
</script>